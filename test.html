<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>3JS Mouse Animation</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body> 
    <script src="../node_modules/three/build/Three.js"></script>
    <script type="module">
      // Set up the scene, camera, and renderer
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.z = 5;
      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Set up the wireframe planet mesh
      var planetGeometry = new THREE.IcosahedronGeometry(2, 4);
      var planetMaterial = new THREE.MeshBasicMaterial({
        color: 0xffffff,
        wireframe: true,
      });
      var planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
      scene.add(planetMesh);

      // Set up the glowing sphere
      var glowGeometry = new THREE.SphereGeometry(2.1, 32, 32);
      var glowMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { type: "f", value: 0.0 },
          resolution: { type: "v2", value: new THREE.Vector2() },
        },
        vertexShader: document.getElementById("glowVertexShader").textContent,
        fragmentShader: document.getElementById("glowFragmentShader").textContent,
        transparent: true,
      });
      var glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
      scene.add(glowMesh);

      // Set up the mouse position
      var mouseX = 0;
      var mouseY = 0;

      // Add an event listener to update the mouse position on mousemove
      document.addEventListener("mousemove", function (event) {
        mouseX = (event.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
      });

      // Set up the animation loop
      var clock = new THREE.Clock();
      function animate() {
        requestAnimationFrame(animate);

        // Rotate the wireframe planet mesh based on the mouse position
        planetMesh.rotation.x = mouseY;
        planetMesh.rotation.y = mouseX;

        // Update the time uniform for the glowing sphere material
        glowMaterial.uniforms.time.value = clock.getElapsedTime();

        // Render the scene
        renderer.render(scene, camera);
      }
      animate();

      // Set up the post-processing effects
      var composer = new THREE.EffectComposer(renderer);
      var renderPass = new THREE.RenderPass(scene, camera);
      composer.addPass(renderPass);
      var glitchPass = new THREE.ShaderPass(THREE.GlitchShader);
      // Configure the glitch effect
      glitchPass.uniforms["tDisp"].value = new THREE.TextureLoader().load(
        "https://cdn.rawgit.com/evanw/glfx.js/master/demo/textures/DisplacementMap.png"
      );
      glitchPass.uniforms["amount"].value = 0;
      glitchPass.renderToScreen = true;
      composer.addPass(glitchPass);

      // Resize the renderer and camera when the window is resized
      window.addEventListener("resize", function () {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        composer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>

    <!-- Shaders for the glowing sphere -->
    <script id="glowVertexShader" type="x-shader/x-vertex">
      uniform float time;

      varying vec3 vNormal;

      void main() {
        vNormal = normal;
        vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * modelViewPosition;
      }
    </script>
    <script id="glowFragmentShader" type="x-shader/x-fragment">
      uniform float time;
      uniform vec2 resolution;

      varying vec3 vNormal;

      void main() {
        vec2 p = (gl_FragCoord.xy * 2.0 - resolution.xy) / min(resolution.x, resolution.y);
        float d = length(p);
        vec3 color = vec3(1.0, 0.3, 0.0);
        vec3 glow = vec3(1.0, 0.8, 0.2);
        vec3 finalColor = mix(color, glow, smoothstep(0.5, 0.4, sin(d * 10.0 + time)));
        gl_FragColor = vec4(finalColor, 1.0);
      }
    </script>
  </body>
</html>
